# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных

Код презентера не вынесен в отдельный класс и содержится в основном скрипте.

В приложении используется событийно-ориентированный подход.

## Базовые классы

### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный 
объект с заголовками запросов.

Методы:
- `get` - выполняет GET запрос на переданный в параметрах эндпоинт и возвращает промис с объектом, которым 
ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные
на эндпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса
может быть переопределен заданием третьего параметра при вызове

### Класс EventEmitter
Брокер событий, позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется
в презентере для обработки событий и в слоях приложения для генерации событий.  

Основные методы, реализуемые классом, описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Класс Component\<T>
Абстрактный класс, от которого наследуются все классы слоя представления. Конструктор 
принимает корневой DOM-элемент и экземпляр класса брокера событий с интерфейсом `IEvents`. В качестве дженерика 
передается тип данных, описывающий объект, чьи данные будут передаваться в метод рендера и устанавливаться 
внутри класса через сеттеры.

Содержит методы для работы с DOM в дочерних компонентах:
- `toggleClass` - переключить класс
- `setText` - установить текстовое содержимое
- `setDisabled` - сменить статус блокировки
- `setHidden` - скрыть
- `setVisible` - показать
- `setImage` - установить изображение с альтернативным текстом
- `render` - вернуть корневой DOM-элемент

## Типы данных

### IItem
Товар в каталоге.

Поля:
- `id: string` - уникальный идентификатор
- `description: string` - описание товара
- `image: string` - URL изображения
- `title: string` - название товара
- `category: string` - категория товара
- `price: number | null` - цена

### ICartItem
Товар в корзине.

Содержит поля `id`, `title`, `price` из `IItem`.

### ICustomer
Данные покупателя для оформления заказа.

Поля:
- `payment: 'online' | 'offline' | ''` - способ оплаты
- `email: string` - электронная почта
- `phone: string` - номер телефона
- `address: string` - адрес доставки

### IOrder
Заказ, расширяет ICustomer.

Поля:
- наследует все поля от `ICustomer`
- `total: number` - общая стоимость товаров
- `items: string[]` - массив ID товаров в заказе

### IOrderResult
Результат успешного оформления заказа.

Поля:
- `id: string` - ID созданного заказа
- `total: number` - итоговая стоимость заказа

### IAppApi
API интерфейс для работы с приложением.

Методы:
- `getItems(): Promise<IItem[]>` - получить список всех товаров
- `orderItems(order: IOrder): Promise<IOrderResult>` - оформить заказ

## Классы слоя данных

### Класс CatalogModel
Хранит список товаров в каталоге на главной странице и отвечает за работу 
с этим каталогом. Конструктор принимает экземпляр класса брокера событий
с интерфейсом `IEvents`.

Поля:
- `items: IItem[]` - список товаров

Методы:
- `setItems(items: IItem[])` - сохранить список товаров
- `getItems(): IItem[]` - получить список товаров
- `getItem(id: string): IItem` - получить товар по ID

События:
- `catalog:changed` - генерируется при вызове `setItems(...)`

### Класс CartModel
Хранит список товаров в корзине и отвечает за работу с корзиной. Конструктор принимает
экземпляр класса брокера событий с интерфейсом `IEvents`.

Поля:
- `items: ICartItem[]` - список товаров в корзине

Методы:
- `addItem(item: ICartItem[])` - добавить товар в корзину
- `removeItem(id: string)` - удалить товар из корзины
- `clear()` - очистить корзину
- `getItems(): ICartItem[]` - получить список товаров в корзине
- `getTotal(): number` - получить общую стоимость товаров в корзине
- `isInCart(id: string): boolean` - проверить находится ли товар в корзине

События:
- `cart:changed` - генерируется при вызове `addItem(...)`, `removeItem(...)`
и `clear()`

### Класс CustomerModel
Хранит данные покупателя и методы для работы с ними. Конструктор принимает 
экземпляр класса брокера событий с интерфейсом `IEvents`.

Поля:
- `customer: ICustomer` - данные покупателя, создается по умолчанию
как объект, в котором все свойства инициализируются пустыми строками

Методы:
- `setData<T extends string>(key: keyof ICustomer, value: T)` - сохранить свойство в объект `customer`
- `clearData()` - очистить данные покупателя (заполнить свойства пустыми строками)
- `getData(): ICustomer` - получить данные покупателя
- `validate(key: keyof ICustomer): boolean` - проверить заполнено ли конкретное свойство

События:
- `customer.${key}:changed` - генерируется при вызове `setData(...)`
- `customer:cleared` - генерируется при вызове `clearData()`

## Классы слоя представления

### Класс Page
Отвечает за отображение главной страницы, наследует `Component<IPage>`.

Поля для элементов разметки:
- `_catalog`
- `_counter`
- `_cart`
- `_wrapper`

Тип данных `IPage` содержит следующие поля (устанавливаются в классе `Page` через сеттеры):
- `counter: number`
- `catalog: HTMLElement[]`
- `locked: boolean`

События:
- `cart:open` - генерируется при клике на `_cart`

### Класс Modal
Отвечает за отображение модального окна, наследует `Component<IModal>`.

Поля для элементов разметки:
- `_content`
- `_closeButton`

Методы:
- `open()` - вызывается при рендере
- `close()` - вызывается при клике на `_closeButton` или вне модального окна

Тип данных `IModal` содержит следующие поля (устанавливаются в классе `Modal` через сеттеры):
- `content: HTMLElement`

События:
- `modal:open` - генерируется при вызове метода `open()`
- `modal:close` - генерируется при вызове метода `close()`

### Класс Card\<T extends ICard>
Абстрактный класс, в котором описываются общие для всех карточек свойства и методы, 
наследует `Component<T>`.

Поля для элементов разметки:
- `_title`
- `_price`

Служебные поля:
- `_id`

Тип данных `ICard` содержит следующие поля (устанавливаются в классе `Card` через сеттеры):
- `id: string`
- `title: string`
- `price: number | null`

### Класс CatalogCard\<T extends ICatalogCard>
Наследуется от класса `Card<T>`, отвечает за отображение карточки в каталоге.

Поля для элементов разметки:
- `_category`
- `_image`

Тип данных `ICatalogCard` расширяет тип `ICard`, добавляя следующие поля 
(устанавливаются в классе `CatalogCard` через сеттеры):
- `category: string`
- `image: string`

События:
- `card:open` - генерируется при клике на карточку (корневой элемент)

### Класс PreviewCard
Наследуется от класса `CatalogCard<IPreviewCard>`, отвечает за отображение карточки в модальном окне (превью).

Поля для элементов разметки:
- `_description`
- `_button`

Тип данных `IPreviewCard` расширяет тип `ICatalogCard`, добавляя следующие поля
(устанавливаются в классе `PreviewCard` через сеттеры):
- `description: string` 
- `buttonText: string`

События:
- `cart:change` - генерируется при клике на `_button`

### Класс CartCard
Наследуется от класса `Card<ICartCard>`, отвечает за отображение карточки в корзине.

Поля для элементов разметки:
- `_index`
- `_removeButton`

Тип данных `ICartCard` расширяет тип `ICard`, добавляя следующие поля
(устанавливаются в классе `CartCard` через сеттеры):
- `index: number`

События:
- `cart:change` - генерируется при клике на `_button`

### Класс Form\<T extends IForm>
Абстрактный класс, в котором описываются общие для всех форм свойства и методы,
наследует `Component<T>`.

Поля для элементов разметки:
- `_errors`
- `_submit`

Тип данных `IForm` содержит следующие поля (устанавливаются в классе `Form` через сеттеры):
- `valid: boolean`
- `errors: string[]`

События:
- `formField:change` - генерируется при изменении поля ввода
- `${this.container.name}:submit` (где `this.container` - корневой элемент) - генерируется при сабмите

### Класс OrderForm
Наследуется от `Form<IOrderForm>`, отвечает за отображение формы со способом оплаты и адресом.

Поля для элементов разметки:
- `_onlineButton`
- `_offlineButton`
- `_adress`

Тип данных `IOrderForm` расширяет тип `IForm`, добавляя следующие поля
(устанавливаются в классе `OrderForm` через сеттеры):
- `payment: 'online' | 'offline' | ''`
- `adress: string`

События:
- `formField:change` - генерируется при выборе способа оплаты

### Класс ContactsForm
Наследуется от `Form<IContactsForm>`, отвечает за отображение формы с контактами (электронная почта и телефон).

Поля для элементов разметки:
- `_email`
- `_phone`

Тип данных `IContactsForm` расширяет тип `IForm`, добавляя следующие поля
(устанавливаются в классе `ContactsForm` через сеттеры):
- `email: string`
- `phone: string`

### Класс Cart
Отвечает за отображение корзины, наследует `Component<ICart>`.

Поля для элементов разметки:
- `_list`
- `_button`
- `_total`

Тип данных `ICart` содержит следующие поля (устанавливаются в классе `Cart` через сеттеры):
- `items: HTMLElement[]`
- `total: number`

События:
- `order:open` - генерируется при клике на `_button`

### Класс Success
Отвечает за отображение экрана успешного заказа, наследует `Component<ISuccess>`.

Поля для элементов разметки:
- `_closeButton`

Тип данных `ISuccess` содержит следующие поля (устанавливаются в классе `Success` через сеттеры):
- `total: number`

События:
- `success:close` - генерируется при клике на `_closeButton`