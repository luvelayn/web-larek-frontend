# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом
- src/components/view/ — папка с компонентами отображения
- src/components/model/ — папка с моделями
- src/components/services/ — папка с сервисами

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных

Код презентера не вынесен в отдельный класс и содержится в основном скрипте.

В приложении используется событийно-ориентированный подход.

## Базовые классы

### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный 
объект с заголовками запросов.

Методы:
- `get` - выполняет GET запрос на переданный в параметрах эндпоинт и возвращает промис с объектом, которым 
ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные
на эндпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса
может быть переопределен заданием третьего параметра при вызове

### Класс EventEmitter
Брокер событий, позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется
в презентере для обработки событий и в слоях приложения для генерации событий.  

Основные методы, реализуемые классом, описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Класс Component\<T>
Абстрактный класс, от которого наследуются все классы слоя представления. Конструктор 
принимает корневой DOM-элемент и экземпляр класса брокера событий с интерфейсом `IEvents`. В качестве дженерика 
передается тип данных, описывающий объект, чьи данные будут передаваться в метод рендера и устанавливаться 
внутри класса через сеттеры.

Содержит методы для работы с DOM в дочерних компонентах:
- `toggleClass` - переключить класс
- `setText` - установить текстовое содержимое
- `setDisabled` - сменить статус блокировки
- `setHidden` - скрыть
- `setVisible` - показать
- `setImage` - установить изображение с альтернативным текстом
- `render` - вернуть корневой DOM-элемент

## Типы данных

### IItem
Товар в каталоге.

Поля:
- `id: string` - уникальный идентификатор
- `description: string` - описание товара
- `image: string` - URL изображения
- `title: string` - название товара
- `category: string` - категория товара
- `price: number | null` - цена

### ICustomer
Данные покупателя для оформления заказа.

Поля:
- `payment: 'online' | 'offline' | ''` - способ оплаты
- `email: string` - электронная почта
- `phone: string` - номер телефона
- `address: string` - адрес доставки

### IOrder
Заказ, расширяет ICustomer.

Поля:
- наследует все поля от `ICustomer`
- `total: number` - общая стоимость товаров
- `items: string[]` - массив ID товаров в заказе

### IOrderResult
Результат успешного оформления заказа.

Поля:
- `id: string` - ID созданного заказа
- `total: number` - итоговая стоимость заказа

### IValidationErrors
Ошибки валидации.

Поля:
- все поля `ICustomer`, но значения - строки 
(сообщения об ошибке)

### IAppApi
API интерфейс для работы с приложением.

Методы:
- `getItems(): Promise<IItem[]>` - получить список всех товаров
- `orderItems(order: IOrder): Promise<IOrderResult>` - оформить заказ

## Классы слоя данных

### Класс CatalogModel
Хранит список товаров в каталоге на главной странице и отвечает за работу 
с этим каталогом. Конструктор принимает экземпляр класса брокера событий
с интерфейсом `IEvents`.

Поля:
- `items: IItem[]` - список товаров

Методы:
- `setItems(items: IItem[])` - сохранить список товаров
- `getItems(): IItem[]` - получить список товаров
- `getItem(id: string): IItem` - получить товар по ID

События:
- `CATALOG_ITEMS_CHANGED` - генерируется при вызове `setItems(...)`

### Класс CartModel
Хранит список товаров в корзине и отвечает за работу с корзиной. Конструктор принимает
экземпляр класса брокера событий с интерфейсом `IEvents`.

Поля:
- `items: IItem[]` - список товаров в корзине

Методы:
- `addItem(item: IItem)` - добавить товар в корзину
- `removeItem(id: string)` - удалить товар из корзины
- `clear()` - очистить корзину
- `getItems(): IItem[]` - получить список товаров в корзине
- `getTotal(): number` - получить общую стоимость товаров в корзине
- `isInCart(id: string): boolean` - проверить находится ли товар в корзине

События:
- `CART_ITEMS_CHANGED` - генерируется при вызове `addItem(...)`, `removeItem(...)`
и `clear()`

### Класс CustomerModel
Хранит данные покупателя и методы для работы с ними. Конструктор принимает 
экземпляр класса брокера событий с интерфейсом `IEvents`.

Поля:
- `customer: ICustomer` - данные покупателя, создается по умолчанию
как объект, в котором все свойства инициализируются пустыми строками
- `validationErrors: IValidationErrors` - объект с ошибками валидации

Методы:
- `setData<K extends keyof ICustomer>(key: K, value: ICustomer[K])` - сохранить свойство в объект `customer`
- `clearData()` - очистить данные покупателя (заполнить свойства пустыми строками)
- `clearValidation()` - очистить ошибки валидации
- `getData(): ICustomer` - получить данные покупателя
- `validate(fields?: (keyof ICustomer)[]): boolean` - провалидировать конкретные поля

События:
- `CUSTOMER_CHANGED` - генерируется при вызове `setData(...)`
- `CUSTOMER_VALIDATION_CHANGED` - генерируется при вызове `validate(...)`

## Классы слоя представления

### Класс Page
Отвечает за отображение главной страницы, наследует `Component<IPage>`.

Поля для элементов разметки:
- `_gallery`
- `_counter`
- `_cart`
- `_wrapper`

Тип данных `IPage` содержит следующие поля (устанавливаются в классе `Page` через сеттеры):
- `counter: number`
- `gallery: HTMLElement[]`
- `locked: boolean`

События:
- `CART_ICON_CLICK` - генерируется при клике на `_cart`

### Класс Modal
Отвечает за отображение модального окна, наследует `Component<IModal>`.

Поля для элементов разметки:
- `_content`
- `_closeButton`

Методы:
- `open()` - вызывается при рендере
- `close()` - вызывается при клике на `_closeButton` или вне модального окна

Тип данных `IModal` содержит следующие поля (устанавливаются в классе `Modal` через сеттеры):
- `content: HTMLElement`

События:
- `MODAL_OPEN` - генерируется при вызове метода `open()`
- `MODAL_CLOSE` - генерируется при вызове метода `close()`

### Класс Card\<T extends IItem>
Абстрактный класс, в котором описываются общие для всех карточек свойства и методы, 
наследует `Component<T>`.
Конструктор принимает дополнительный необязательный параметр `actions`, в котором
передается коллбэк, срабатывающий при нажатии на кнопку (если она имеется), либо на контейнер
(если кнопки нет).

Поля для элементов разметки:
- `_title`
- `_price`
- `_description` - необязательное
- `_image` - необязательное
- `_category` - необязательное
- `_button` - необязательное

Служебные поля:
- `_id`

Поля, соответствущие типу данных `IItem`, устанавливаются с помощью сеттеров.

### Класс CatalogCard
Наследуется от класса `Card<IItem>`, отвечает за отображение карточки в каталоге.

События:
- `CATALOG_CARD_CLICK` - генерируется при клике на карточку (корневой элемент)

### Класс PreviewCard
Наследуется от класса `Card<IPreviewCard>`, отвечает за отображение карточки в модальном окне (превью).

Тип данных `IPreviewCard` расширяет тип `IItem`, добавляя следующие поля
(устанавливаются в классе `PreviewCard` через сеттеры):
- `buttonText: string`

События:
- `PREVIEW_CARD_BUTTON_CLICK` - генерируется при клике на `_button`

### Класс CartCard
Наследуется от класса `Card<ICartCard>`, отвечает за отображение карточки в корзине.

Поля для элементов разметки:
- `_index`

Тип данных `ICartCard` расширяет тип `IItem`, добавляя следующие поля
(устанавливаются в классе `CartCard` через сеттеры):
- `index: number`

События:
- `CART_CARD_REMOVE_BUTTON_CLICK` - генерируется при клике на `_removeButton`

### Класс Form\<T>
Абстрактный класс, в котором описываются общие для всех форм свойства и методы,
наследует `Component<IForm>`.

Поля для элементов разметки:
- `_errors`
- `_submitButton`

Тип данных `IForm` содержит следующие поля (устанавливаются в классе `Form` через сеттеры):
- `valid: boolean`
- `errors: string[]`

Методы:
- `onFieldChange(field: keyof T, value: string)` - срабатывает при изменении поля формы

События:
- `FORM_FIELD_CHANGE` - генерируется при изменении поля формы
- `${this.container.name}-FORM_SUBMIT` (где `this.container` - корневой элемент) - генерируется при сабмите

### Класс OrderForm
Наследуется от `Form<IOrderForm>`, отвечает за отображение формы со способом оплаты и адресом.

Поля для элементов разметки:
- `_cardButton`
- `_cashButton`
- `_address`

Тип данных `IOrderForm` содержит следующие поля (устанавливаются в классе `OrderForm` через сеттеры):
- `payment: 'online' | 'offline' | ''`
- `address: string`

Методы:
- `handlePaymentClick` - коллбэк для обработки нажатия по кнопке выбора метода оплаты

### Класс ContactsForm
Наследуется от `Form<IContactsForm>`, отвечает за отображение формы с контактами (электронная почта и телефон).

Поля для элементов разметки:
- `_email`
- `_phone`

Тип данных `IContactsForm` содержит следующие поля (устанавливаются в классе `ContactsForm` через сеттеры):
- `email: string`
- `phone: string`

### Класс Cart
Отвечает за отображение корзины, наследует `Component<ICart>`.

Поля для элементов разметки:
- `_list`
- `_orderButton`
- `_total`

Тип данных `ICart` содержит следующие поля (устанавливаются в классе `Cart` через сеттеры):
- `items: HTMLElement[]`
- `total: number`

События:
- `CART_ORDER_BUTTON_CLICK` - генерируется при клике на `_orderButton`

### Класс Success
Отвечает за отображение экрана успешного заказа, наследует `Component<ISuccess>`.

Поля для элементов разметки:
- `_button`
- `_total`

Тип данных `ISuccess` содержит следующие поля (устанавливаются в классе `Success` через сеттеры):
- `total: number`

События:
- `SUCCESS_BUTTON_CLICK` - генерируется при клике на `_button`